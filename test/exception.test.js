'use strict';

const assert = require('assert');
const ByteBuffer = require('byte');
const hessianV2 = require('../lib/codec/hessian/v2');

describe('test/exception.test.js', () => {
  it('should decode java Exception ok', () => {
    const byteBuffer = ByteBuffer.wrap(Buffer.from('4FBE636F6D2E616C697061792E736F66612E7270632E636F72652E726573706F6E73652E536F6661526573706F6E7365940769734572726F72086572726F724D73670B617070526573706F6E73650D726573706F6E736550726F70736F90464E4FB9636F6D2E616C697061792E736F66612E7270632E717569636B73746172742E54657374244572726F72940D64657461696C4D6573736167650563617573650A737461636B54726163651473757070726573736564457863657074696F6E736F91076D6573736167654A015674001C5B6A6176612E6C616E672E537461636B5472616365456C656D656E746E014FAB6A6176612E6C616E672E537461636B5472616365456C656D656E74940E6465636C6172696E67436C6173730A6D6574686F644E616D650866696C654E616D650A6C696E654E756D6265726F92530023636F6D2E616C697061792E736F66612E7270632E717569636B73746172742E54657374046D61696E09546573742E6A617661AE7A567400326A6176612E7574696C2E436F6C6C656374696F6E7324556E6D6F6469666961626C6552616E646F6D4163636573734C6973746E007A4E', 'hex'));
    const r = hessianV2.decode(byteBuffer, 'com.alipay.sofa.rpc.core.response.SofaResponse');
    assert(r && r.error && r.appResponse == null && r.responseProps == null);
    assert(r.error instanceof Error);
    assert(r.error.message === 'message');
    assert(r.error.name === 'com.alipay.sofa.rpc.quickstart.Test$Error');
    assert(r.error.stack === 'com.alipay.sofa.rpc.quickstart.Test$Error: message\n    at com.alipay.sofa.rpc.quickstart.Test.main (Test.java:30)');
  });
});
